{"componentChunkName":"component---src-templates-blog-post-js","path":"/resolvendo-erro-do-aspath-do-next-js-no-storybook/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://devjuniorplus.com.br"}},"markdownRemark":{"fields":{"slug":"/resolvendo-erro-do-aspath-do-next-js-no-storybook/"},"frontmatter":{"description":"Veja como corrigir erro do useRouter do Next.js no Storybook","title":"Resolvendo erro do \"asPath\" do Next.js no Storybook","date":"20 de novembro de 2021","image":"assets/images/eugen-str-crhsiry3jwy-unsplash.jpeg"},"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDAv/EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABnNLKtEg//8QAGRAAAgMBAAAAAAAAAAAAAAAAAAIBERIg/9oACAEBAAEFAnJfJfH/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAXEQEAAwAAAAAAAAAAAAAAAAAAARES/9oACAECAQE/Adwt/8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACEBEScaH/2gAIAQEABj8CyvqBaN26Ln//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVFx/9oACAEBAAE/IRYhNdCk7Isxwjfc2Aq2xKT2VR8i7P/aAAwDAQACAAMAAAAQEA//xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8QhX//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAECAQE/EFjSD//EABoQAQADAQEBAAAAAAAAAAAAAAERITEAQbH/2gAIAQEAAT8QVqiY0Bd5yhZklPlsZ1WdA0z1JtI4iIegIkyYzM+d5Dv/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image lazyload\"\n        alt=\"Ferramentas \"\n        title=\"Fixing problems\"\n        data-src=\"/static/a73bb2ffa1565d0d7d3134d609016707/18e3b/eugen-str-crhsiry3jwy-unsplash.jpg\"\n        data-srcset=\"/static/a73bb2ffa1565d0d7d3134d609016707/46946/eugen-str-crhsiry3jwy-unsplash.jpg 240w,\n/static/a73bb2ffa1565d0d7d3134d609016707/55489/eugen-str-crhsiry3jwy-unsplash.jpg 480w,\n/static/a73bb2ffa1565d0d7d3134d609016707/18e3b/eugen-str-crhsiry3jwy-unsplash.jpg 960w,\n/static/a73bb2ffa1565d0d7d3134d609016707/60e21/eugen-str-crhsiry3jwy-unsplash.jpg 1440w,\n/static/a73bb2ffa1565d0d7d3134d609016707/69b48/eugen-str-crhsiry3jwy-unsplash.jpg 1920w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3>Introdução</h3>\n<p>Venho estudando bastante documentação no Frontend, especificamente o Storybook e ao mesmo tempo me aprofundo mais no Next.js. Mas hoje tive um erro com o Storybook utilizando o <code class=\"language-text\">useRouter</code> do Next.js.</p>\n<h3>O problema</h3>\n<p>Hoje eu estava criando alguns componentes básicos para treinar a criação de stories e deparei com esse erro:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVR42m2Ry07CQBiFp1haEghQem9pabQkGKiJiYliQ6QYTYi+g25c+P4PcDj/WKoLF1/OnGnmm0vVd1XhhbzfVDhuNjiu1zrf2F+vV9hfXaIpSxyIzuWypex4JjW/fa1WUM0ih+W6cMMQE9+Hw5wGARyB49FsBms0Qm8w0CjL0hi23XFBlNnH03wOtY8i2FyQs0QUJOwRZTFTkB6ye9x0Mh7DpqxvmlBKdfTabOL4jzBNkSaJFgQ8qUhkg7M45li673laLBKjxTQMLTwkFNZRCDUcIqRwSpEg13Upcc5XbxlQpNrF/7GTE37wQe/yDLuiwONioamFQija/Jnf5jnu+TTCQ/bLNstwywN98medAH4Nm6AMq8jZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image lazyload\"\n        alt=\"Erro do asPath\"\n        title=\"Erro do asPath\"\n        data-src=\"/static/8ec6b6d8cd7c5e43978dbf1cd530a6b0/7d769/image-error.png\"\n        data-srcset=\"/static/8ec6b6d8cd7c5e43978dbf1cd530a6b0/5243c/image-error.png 240w,\n/static/8ec6b6d8cd7c5e43978dbf1cd530a6b0/ab158/image-error.png 480w,\n/static/8ec6b6d8cd7c5e43978dbf1cd530a6b0/7d769/image-error.png 960w,\n/static/8ec6b6d8cd7c5e43978dbf1cd530a6b0/87339/image-error.png 1440w,\n/static/8ec6b6d8cd7c5e43978dbf1cd530a6b0/88b03/image-error.png 1920w,\n/static/8ec6b6d8cd7c5e43978dbf1cd530a6b0/6703d/image-error.png 2388w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>O componente que havia criado era apenas um Link que mudava a cor do background se a pagina em que o usuário está é a pagina do link.</p>\n<p>Chamei de <code class=\"language-text\">ActiveLink</code>. Abaixo o código do componente:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> Link<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> LinkProps <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/link'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRouter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/router'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">S</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./styles'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">ActiveLinkProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  children<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>ReactNode<span class=\"token punctuation\">;</span>\n  href<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">&amp;</span> LinkProps<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ActiveLink</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> href<span class=\"token punctuation\">,</span> children<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> ActiveLinkProps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> asPath <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> isCurrentPath <span class=\"token operator\">=</span>\n    asPath <span class=\"token operator\">===</span> href <span class=\"token operator\">||</span> asPath <span class=\"token operator\">===</span> rest<span class=\"token punctuation\">.</span><span class=\"token keyword\">as</span> <span class=\"token operator\">||</span> asPath<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>rest<span class=\"token punctuation\">.</span><span class=\"token keyword\">as</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Link href<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>href<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>rest<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">.</span>LinkActived isActive<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span>isCurrentPath<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token constant\">S</span><span class=\"token punctuation\">.</span>LinkActived<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ActiveLink<span class=\"token punctuation\">;</span></code></pre></div>\n<p>O problema vem exatamente de estar utilizando o <code class=\"language-text\">userRouter</code> do Next.js, pois o Storybook não \"conhece\" esse elemento o que acaba gerando o erro.</p>\n<h3>Corrigindo o erro</h3>\n<p>Para corrigir é simples, primeiro vamos instalar um <code class=\"language-text\">addon</code> para o Storybook. (Se você não sabe o que é um Addon, basta acessar <a href=\"https://storybook.js.org/addons\">aqui</a>).</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D storybook-addon-next-router\n<span class=\"token comment\"># ou</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev storybook-addon-next-router</code></pre></div>\n<p>Depois de instalado, agora presicamos criar uma pasta (se ainda não tiver) na raiz do projeto para as confiurações do Storybook:</p>\n<p><code class=\"language-text\">.storybook/preview.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RouterContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"next/dist/shared/lib/router-context\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> parameters <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  nextRouter<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    Provider<span class=\"token operator\">:</span> RouterContext<span class=\"token punctuation\">.</span>Provider<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Agora vamos criar o <code class=\"language-text\">.storybook/main.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">module</span><span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  addons<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@storybook/addon-essentials'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'storybook-addon-next-router'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Agora precisamos apenas passar a informação do nextRouter no stories do componente que estava com erro:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  title<span class=\"token operator\">:</span> <span class=\"token string\">'ActiveLink'</span><span class=\"token punctuation\">,</span>\n  component<span class=\"token operator\">:</span> ActiveLink<span class=\"token punctuation\">,</span>\n  parameters<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    nextRouter<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      path<span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n      asPath<span class=\"token operator\">:</span> <span class=\"token string\">'/'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> Meta<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pronto!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.166666666666664%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image lazyload\"\n        alt=\"Erro corrigido\"\n        title=\"Erro corrigido\"\n        data-src=\"/static/617af902c47287c73b1a70893a9c7eef/7d769/screen-shot-2021-11-20-at-7.11.21-am.png\"\n        data-srcset=\"/static/617af902c47287c73b1a70893a9c7eef/5243c/screen-shot-2021-11-20-at-7.11.21-am.png 240w,\n/static/617af902c47287c73b1a70893a9c7eef/ab158/screen-shot-2021-11-20-at-7.11.21-am.png 480w,\n/static/617af902c47287c73b1a70893a9c7eef/7d769/screen-shot-2021-11-20-at-7.11.21-am.png 960w,\n/static/617af902c47287c73b1a70893a9c7eef/87339/screen-shot-2021-11-20-at-7.11.21-am.png 1440w,\n/static/617af902c47287c73b1a70893a9c7eef/88b03/screen-shot-2021-11-20-at-7.11.21-am.png 1920w,\n/static/617af902c47287c73b1a70893a9c7eef/7c0ae/screen-shot-2021-11-20-at-7.11.21-am.png 1939w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3>Conslusão</h3>\n<p>Qualquer dúvida ou sugestão, deixe nos comentários, gostaria de ter seu feedback! Espero ter ajudado com esse post, fique com Deus e até a próxima. 😎</p>","timeToRead":2}},"pageContext":{"slug":"/resolvendo-erro-do-aspath-do-next-js-no-storybook/","previousPost":{"fields":{"slug":"/criando-formulários-com-react-hook-form/"},"frontmatter":{"title":"Criando formulários com React Hook Form"}},"nextPost":{"fields":{"slug":"/meu-ano-de-2021/"},"frontmatter":{"title":"Meu ano de 2021"}}}},"staticQueryHashes":["2037742868","3149229692","764694655"]}